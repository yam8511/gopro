(function(t){function e(e){for(var a,s,o=e[0],c=e[1],l=e[2],u=0,d=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&d.push(i[s][0]),i[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);f&&f(e);while(d.length)d.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,s=1;s<n.length;s++){var o=n[s];0!==i[o]&&(a=!1)}a&&(r.splice(e--,1),t=c(c.s=n[0]))}return t}var a={},s={app:0},i={app:0},r=[];function o(t){return c.p+"js/"+({about:"about"}[t]||t)+"."+{about:"f27da688"}[t]+".js"}function c(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(t){var e=[],n={about:1};s[t]?e.push(s[t]):0!==s[t]&&n[t]&&e.push(s[t]=new Promise((function(e,n){for(var a="css/"+({about:"about"}[t]||t)+"."+{about:"943d4e88"}[t]+".css",i=c.p+a,r=document.getElementsByTagName("link"),o=0;o<r.length;o++){var l=r[o],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===a||u===i))return e()}var d=document.getElementsByTagName("style");for(o=0;o<d.length;o++){l=d[o],u=l.getAttribute("data-href");if(u===a||u===i)return e()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=e,f.onerror=function(e){var a=e&&e.target&&e.target.src||i,r=new Error("Loading CSS chunk "+t+" failed.\n("+a+")");r.code="CSS_CHUNK_LOAD_FAILED",r.request=a,delete s[t],f.parentNode.removeChild(f),n(r)},f.href=i;var m=document.getElementsByTagName("head")[0];m.appendChild(f)})).then((function(){s[t]=0})));var a=i[t];if(0!==a)if(a)e.push(a[2]);else{var r=new Promise((function(e,n){a=i[t]=[e,n]}));e.push(a[2]=r);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=o(t);var d=new Error;l=function(e){u.onerror=u.onload=null,clearTimeout(f);var n=i[t];if(0!==n){if(n){var a=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src;d.message="Loading chunk "+t+" failed.\n("+a+": "+s+")",d.name="ChunkLoadError",d.type=a,d.request=s,n[1](d)}i[t]=void 0}};var f=setTimeout((function(){l({type:"timeout",target:u})}),12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(e)},c.m=t,c.c=a,c.d=function(t,e,n){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)c.d(n,a,function(e){return t[e]}.bind(null,a));return n},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/",c.oe=function(t){throw console.error(t),t};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=e,l=l.slice();for(var d=0;d<l.length;d++)e(l[d]);var f=u;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},1329:function(t,e,n){},"146a":function(t,e,n){},"24ff":function(t,e,n){},3786:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s}));n("d3b7");function a(){return fetch("/api/auth/user")}function s(t,e){return fetch("/api/auth/login",{method:"post",body:JSON.stringify({username:t,password:e}),headers:{"Content-Type":"application/json"}})}},"475c":function(t,e,n){"use strict";n("146a")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("a766"),n("64e3"),n("7c04");var a=n("2b0e"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[t.showNav?n("nav",{staticClass:"navbar navbar-expand-lg navbar-light bg-light border-bottom"},[n("router-link",{staticClass:"navbar-brand",attrs:{to:"/"}},[n("div",{staticClass:"backgroundLogo"})]),n("span",{staticClass:"d-none"},[t._v("Welcome, "+t._s(t.username))]),t._m(0),n("div",{staticClass:"collapse navbar-collapse",attrs:{id:"navbarSupportedContent"}},[n("ul",{staticClass:"navbar-nav mr-auto d-none"},[n("li",{staticClass:"nav-item"},[n("router-link",{staticClass:"nav-link",attrs:{to:"/"}},[t._v("Home")])],1),n("li",{staticClass:"nav-item"},[n("router-link",{staticClass:"nav-link",attrs:{to:"/login"}},[t._v("Login")])],1)])])],1):t._e(),t.canShow?n("router-view"):t._e()],1)},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("button",{staticClass:"navbar-toggler",attrs:{type:"button","data-toggle":"collapse","data-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"}},[n("span",{staticClass:"navbar-toggler-icon"})])}],r=(n("99af"),n("b0c0"),n("3786")),o={data:function(){return{username:"",has_login:!1}},computed:{showNav:function(){return this.$route&&"Login"!=this.$route.name},canShow:function(){return!this.showNav||this.has_login}},watch:{$route:function(){this.checkLogin()}},methods:{checkLogin:function(){var t=this;Object(r["a"])().then((function(t){if(200==t.status)return t.json();window.alert("系統異常: ".concat(t.statusText))})).then((function(e){0===e.error_code?null!=e.data&&(t.username=e.data,t.$route&&"/"!==t.$route.path&&t.$router.push("/"),t.has_login=!0):t.$route&&"/login"!==t.$route.path&&(t.$router.push("/login"),8e3===e.error_code?window.alert("No Permission. (".concat(e.error_code,")")):8001===e.error_code?window.alert("Please login first. (".concat(e.error_code,")")):window.alert("System Error: ".concat(e.error_text,"(").concat(e.error_code,")")))}))}},mounted:function(){this.checkLogin()}},c=o,l=(n("5c0b"),n("2877")),u=Object(l["a"])(c,s,i,!1,null,null,null),d=u.exports,f=(n("d3b7"),n("8c4f")),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home container-fluid"},[n("draggable",{staticClass:"row",attrs:{group:"camera"},on:{start:function(e){t.drag=!0},end:function(e){t.drag=!1}},model:{value:t.cams,callback:function(e){t.cams=e},expression:"cams"}},t._l(t.cams,(function(e){return n("CamDrag",{key:e.key,class:e.class,style:e.style,attrs:{id:e.id,data:e.data,setting_fn:t.setting_fn("setting",!0),alarm_fn:t.setting_fn("alarm",!0)}})})),1),this.show_alarm?n("Alarm",{attrs:{setting_fn:t.setting_fn("alarm",!1),cam:t.cam}}):t._e(),this.show_setting?n("Setting",{attrs:{setting_fn:t.setting_fn("setting",!1),cam:t.cam}}):t._e()],1)},h=[],p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:""!=t.danger?"CameDrag border overflow-auto danger":"CameDrag border overflow-auto",on:{dblclick:function(e){return t.toggle_cam(null)},mouseenter:function(e){return t.toggle_cam(!1)},mouseleave:function(e){return t.toggle_cam(!0)}}},[n("div",{staticClass:"w-100 justify-content-center align-items-center d-flex"},[t.show_cam?n("div",[n("div",{staticClass:"w3-card-4 w3-padding"},[n("div",{staticClass:"w3-display-container w3-center",class:{"w3-opacity":!t.connecting}},[n("img",{staticClass:"w-100 h-100",attrs:{src:t.img,alt:""}}),t.connecting?[""!=t.signal?n("span",{staticClass:"w3-padding w3-display-middle text-danger"},[t._v(" "+t._s(t.signal)+" "),n("i",{staticClass:"fa fa-spinner w3-spin"})]):t._e(),t._m(0)]:n("div",{staticClass:"w3-display-middle w3-xlarge"},[n("i",{staticClass:"fas fa-video-slash"})])],2)])]):n("div",{staticClass:"w-100"},[n("div",{staticClass:"w-100 text-left"},[n("span",[t._v("描述")]),n("br"),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.cam.description,expression:"cam.description"}],staticClass:"border-0 w-100",attrs:{rows:"1",readonly:""},domProps:{value:t.cam.description},on:{input:function(e){e.target.composing||t.$set(t.cam,"description",e.target.value)}}})]),n("div",{staticClass:"w-100 text-right"},[n("span",{staticClass:"text-success pointer mr-2",on:{click:function(e){return t.setting_fn(this)}}},[n("i",{staticClass:"fa-lg fas fa-edit"})]),n("span",{staticClass:"button pointer",on:{click:function(e){return t.alarm_fn(this)}}},[t._v("關閉警報")])]),n("div",{staticClass:"w-100 text-right"},[n("div",{staticClass:"custom-control custom-switch"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.cam.fence_enable,expression:"cam.fence_enable"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:t.cam.camera_id+"-ai-switch"},domProps:{checked:Array.isArray(t.cam.fence_enable)?t._i(t.cam.fence_enable,null)>-1:t.cam.fence_enable},on:{change:[function(e){var n=t.cam.fence_enable,a=e.target,s=!!a.checked;if(Array.isArray(n)){var i=null,r=t._i(n,i);a.checked?r<0&&t.$set(t.cam,"fence_enable",n.concat([i])):r>-1&&t.$set(t.cam,"fence_enable",n.slice(0,r).concat(n.slice(r+1)))}else t.$set(t.cam,"fence_enable",s)},t.open_ai_confirm]}}),n("label",{staticClass:"custom-control-label",attrs:{for:t.cam.camera_id+"-ai-switch"}},[t._v("AI偵測")])]),t.show_ai_confirm?n("Confirm",{attrs:{callback_fn:t.take_username(),close_fn:t.close_ai_confirm}}):t._e()],1)])])])},g=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"w3-padding w3-display-topleft text-danger"},[n("i",{staticClass:"fas fa-video"})])}],_=(n("c975"),n("a9e3"),n("5530")),v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"light"},[n("span",{staticClass:"float-right pointer",on:{click:t.close}},[n("i",{staticClass:"fas fa-times"})]),n("br"),t._m(0),n("div",{staticClass:"ml-3"},[n("span",{staticClass:"enter-label text-right"},[t._v("User ID")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],staticClass:"border rounded ml-4 enter",attrs:{placeholder:"your username"},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}}),n("br"),n("br"),n("span",{staticClass:"enter-label text-right"},[t._v("Password")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"border rounded ml-2 enter",attrs:{placeholder:"your password",type:"password"},domProps:{value:t.password},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.confirm(e)},input:function(e){e.target.composing||(t.password=e.target.value)}}}),n("br"),""!=t.hint?n("span",{staticClass:"bg-gradient-danger text-danger text-left"},[t._v(" "+t._s(t.hint)+" ")]):t._e(),n("br"),n("div",{staticClass:"w-100 text-right pr-4"},[n("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button"},on:{click:function(e){return t.close()}}},[t._v(" 取消 ")]),n("button",{staticClass:"btn btn-warning",attrs:{type:"button"},on:{click:function(e){return t.confirm()}}},[t._v(" 確認 ")])])])]),n("div",{staticClass:"fades"})])},w=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"text-left ml-2 mb-4"},[n("h5",[t._v("二次驗證")])])}],b=(n("a15b"),n("498a"),{name:"Confirm",data:function(){return{username:"",password:"",hint:""}},watch:{username:function(t){this.hint="",this.username=t.trim()},password:function(t){this.hint="",this.password=t.trim()}},props:{callback_fn:{type:Function,default:function(){}},close_fn:{type:Function,default:function(){}},cam:{}},computed:{},methods:{close:function(){this.close_fn()},confirm:function(){var t=[];""===this.username&&t.push("帳號"),""===this.password&&t.push("密碼"),t.length>0?this.hint="請輸入"+t.join(", "):this.callback_fn(this.username,this.password)}}}),y=b,x=(n("475c"),Object(l["a"])(y,v,w,!1,null,"e78ad21e",null)),C=x.exports;function k(t,e){return fetch("/api/cam/camera/single/".concat(t),{method:"put",body:JSON.stringify({description:e}),headers:{"Content-Type":"application/json"}})}function j(t,e,n,a){return fetch("/api/cam/camera/".concat(t,"/fence-enable"),{method:"put",body:JSON.stringify({username:n,password:a,enable:e}),headers:{"Content-Type":"application/json"}})}function P(t){return fetch("/api/cam/camera/".concat(t))}var S={name:"CameDrag",props:{id:Number,data:{},setting_fn:{type:Function,default:function(){}},alarm_fn:{type:Function,default:function(){}}},components:{Confirm:C},data:function(){return{show_cam:!0,ws:null,send_ws:function(){},close_ws:function(){},img:"",connecting:!1,signal:"",danger:"",show_ai_confirm:!1,cam:{}}},methods:{IsPC:function(){for(var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=!0,a=0;a<e.length;a++)if(t.indexOf(e[a])>0){n=!1;break}return n},get_img:function(){return""!=this.img?"background: url('data:image/png;base64,".concat(this.img,"') center center /cover"):""},toggle_cam:function(t){null==t?this.show_cam=!this.show_cam:this.IsPC()||(this.show_cam=t);//!this.show_cam;
},close_alarm:function(){console.log("關閉警報")},open_ai_confirm:function(){this.show_ai_confirm=!0},close_ai_confirm:function(){var t=this;P(this.cam.camera_id).then((function(t){if(200==t.status)return t.json();window.alert("系統異常: ".concat(t.statusText))})).then((function(e){0===e.error_code?t.cam=e.data:window.alert("".concat(e.error_text," (").concat(e.error_code,")"))})).catch((function(t){return window.alert("網頁異常",t)})).finally((function(){return t.show_ai_confirm=!1}))},take_username:function(){var t=this;return function(e,n){var a=this;!1!==t.show_ai_confirm&&j(t.cam.camera_id,t.cam.fence_enable,e,n).then((function(t){if(200==t.status)return t.json();window.alert("系統異常: ".concat(t.statusText))})).then((function(e){0===e.error_code?(a.origin_ai_enable=t.ai_enable,t.close_ai_confirm(!0)):8e3==e.error_code?a.hint="帳號密碼錯誤":a.hint="帳號密碼錯誤: ".concat(e.error_text,"(").concat(e.error_code,")")})).catch((function(t){return window.alert("網頁異常",t)}))}}},mounted:function(){var t=this;this.cam=Object(_["a"])({},this.data);var e="https:"===window.location.protocol?"wss":"ws";this.ws=new WebSocket("".concat(e,"://").concat(window.location.host,"/ws/camera/streaming/").concat(this.cam.camera_id)),this.ws.onopen=function(){t.connecting=!0,t.danger="",t.warning="",t.close_ws=function(){return t.ws.close()},t.send_ws=function(e){return t.ws.send(JSON.stringify(e))}},this.ws.onerror=function(){t.warning="連線失敗"},this.ws.onclose=function(){t.connecting=!1,t.close_ws=function(){},t.send_ws=function(){}},this.ws.onmessage=function(e){var n=JSON.parse(e.data);if(0===n.error_code){var a=n.data;"image"===a.event?(t.img="data:image/png;base64, ".concat(a.image),t.signal=""):"alert"===a.event?t.danger=a.time:"safe"===a.event?t.danger="":"signal"===a.event&&(t.signal=a.image)}else t.warning=n.error_text}}},O=S,E=(n("75a4"),Object(l["a"])(O,p,g,!1,null,"6f4b6259",null)),$=E.exports,N=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"light"},[n("span",{staticClass:"float-right pointer",on:{click:t.close}},[n("i",{staticClass:"fas fa-times"})]),n("br"),t._m(0),n("div",[n("div",{staticClass:"input-group mb-2"},[n("span",{staticClass:"input-group-text"},[t._v("描述")]),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"form-control",attrs:{"aria-label":"With textarea"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}}),n("span",{staticClass:"btn btn-danger clear",on:{click:function(e){return t.clear_points(640,480)}}},[t._v(" 圍籬 "),n("i",{staticClass:"fas fa-eraser"})])]),n("div",{staticClass:"w-100 d-flex justify-content-center"},[""==t.img?n("span",{staticClass:"w3-padding w3-display-middle text-danger"},[t._v(" 連線失敗 "),n("i",{staticClass:"fa fa-spinner w3-spin"})]):t._e(),n("canvas",{ref:"canvasElement",class:""!=t.img?"border":"border d-none",style:t.img,attrs:{width:t.width,height:t.height},on:{click:t.add_point}})]),""!=t.img?n("div",{staticClass:"w-100 text-center mt-2"},[n("span",{staticClass:"btn btn-primary",on:{click:t.setting_send}},[t._v("設定")])]):t._e()])]),n("div",{staticClass:"fades"})])},T=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"text-left ml-2 mb-4"},[n("h5",[t._v("電子圍籬設定")])])}];n("a4d3"),n("e01a"),n("cb29");function A(t,e){return fetch("/api/cam/fence/"+t,{method:"put",body:JSON.stringify({points:e}),headers:{"Content-Type":"application/json"}})}function L(t){return fetch("/api/cam/fence/"+t)}var D={name:"Setting",data:function(){return{description:"",points:[],ctx:{},ws:WebSocket,img:"",width:640,height:480,finish_setting:!1}},props:{setting_fn:{type:Function,default:function(){}},cam:{}},computed:{},methods:{close:function(){this.ws.close(),this.setting_fn("setting",!1)},setting_send:function(){var t=this;if(this.finish_setting){var e=A(this.cam.camera_id,this.points);e.then((function(t){if(200==t.status)return t.json();window.alert("系統異常: ".concat(t.statusText))})).then((function(e){console.log(e),0===e.error_code?(k(t.cam.camera_id,t.description),window.alert("設定成功！！"),t.cam.description=t.description,t.close()):window.alert("設定錯誤: ".concat(e.error_text,"(").concat(e.error_code,")"))}))}else{var n=k(this.cam.camera_id,this.description);n.then((function(t){if(200==t.status)return t.json();window.alert("系統異常: ".concat(t.statusText))})).then((function(e){console.log(e),0===e.error_code?(window.alert("設定成功！！"),t.cam.description=t.description,t.close()):window.alert("設定錯誤: ".concat(e.error_text,"(").concat(e.error_code,")"))}))}},getEventPosition:function(t){var e,n;return t.layerX||0==t.layerX?(e=t.layerX,n=t.layerY):(t.offsetX||0==t.offsetX)&&(e=t.offsetX,n=t.offsetY),{x:e,y:n}},set_canvas:function(){var t=this.$refs["canvasElement"],e=t.getContext("2d");this.ctx=e},clear_points:function(t,e){this.points=[],this.finish_setting=!1,this.ctx.clearRect(0,0,t,e)},segmentsIntr:function(t,e,n,a){var s=(e.y-t.y)*(a.x-n.x)-(t.x-e.x)*(n.y-a.y);if(0==s)return!1;var i=((e.x-t.x)*(a.x-n.x)*(n.y-t.y)(e.y-t.y)*(a.x-n.x)*t.x-(a.y-n.y)*(e.x-t.x)*n.x)/s,r=-((e.y-t.y)*(a.y-n.y)*(n.x-t.x)(e.x-t.x)*(a.y-n.y)*t.y-(a.x-n.x)*(e.y-t.y)*n.y)/s;return(i-t.x)*(i-e.x)<=0&&(r-t.y)*(r-e.y)<=0&&(i-n.x)*(i-a.x)<=0&&(r-n.y)*(r-a.y)<=0&&{x:i,y:r}},twoPointDistance:function(t,e){var n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));return n},draw:function(){for(var t=0;t<this.points.length;t++)t+1<this.points.length&&(this.ctx.moveTo(this.points[t].x,this.points[t].y),this.ctx.lineTo(this.points[t+1].x,this.points[t+1].y),this.ctx.strokeStyle="yellow",this.ctx.lineWidth=3,this.ctx.stroke()),this.ctx.strokeStyle="red",this.ctx.fillStyle="red",this.ctx.beginPath(),this.ctx.arc(this.points[t].x,this.points[t].y,5,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.stroke(),this.ctx.fill()},add_point:function(t){var e=this.getEventPosition(t);if(this.finish_setting)window.alert("已完成設定");else{if(this.points.length>0&&this.twoPointDistance(this.points[0],e)<=5)return this.finish_setting=!0,this.points.push(this.points[0]),this.draw(),void console.log(this.points);this.points.push(e),this.draw()}},connect:function(){var t=this;this.ws=new WebSocket("ws://".concat(window.location.host,"/ws/camera/streaming/").concat(this.cam.camera_id)),this.ws.onopen=function(){t.close_ws=function(){return t.ws.close()},t.send_ws=function(e){return t.ws.send(e)}},this.ws.onmessage=function(e){var n=JSON.parse(e.data);if(0===n.error_code){var a=n.data;if("image"===a.event){var s=new Image;s.src="data:image/png;base64,".concat(a.image),t.height=0!=s.height?s.height:t.height,t.width=0!=s.width?s.width:t.width,t.img="background: url('data:image/png;base64,".concat(a.image,"') center center /cover")}}};var e=L(this.cam.camera_id);e.then((function(t){if(200==t.status)return t.json();window.alert("系統異常: ".concat(t.statusText))})).then((function(e){console.log(e),0===e.error_code?(t.points=e.data.points,t.draw()):6e3!=e.error_code&&window.alert("設定錯誤: ".concat(e.error_text,"(").concat(e.error_code,")"))}))}},mounted:function(){this.set_canvas(),this.connect(),this.description=this.cam.description}},I=D,J=(n("f32a"),Object(l["a"])(I,N,T,!1,null,"c031af94",null)),F=J.exports,M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"light"},[n("span",{staticClass:"float-right pointer",on:{click:t.close}},[n("i",{staticClass:"fas fa-times"})]),n("br"),t._m(0),n("div",{staticClass:"ml-3"},[n("span",{staticClass:"enter-label text-right"},[t._v("User ID")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],staticClass:"border rounded ml-4 enter",attrs:{placeholder:"your username"},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}}),n("br"),n("br"),n("span",{staticClass:"enter-label text-right"},[t._v("Password")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"border rounded ml-2 enter",attrs:{type:"password"},domProps:{value:t.password},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.close_alarm(e)},input:function(e){e.target.composing||(t.password=e.target.value)}}}),n("br"),t._m(1),n("br"),n("div",{staticClass:"w-100 text-right pr-4"},[n("span",{staticClass:"button pointer",on:{click:function(e){return t.close_alarm()}}},[n("strong",[t._v("Login")])])])])]),n("div",{staticClass:"fades"})])},W=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"text-left ml-2 mb-4"},[n("h5",[t._v("關閉警報")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"w-100 text-right pr-4"},[n("span",{staticClass:"text-right forget mt-2 d-none"},[t._v("Forget Password")])])}],X={name:"Alarm",data:function(){return{username:"",password:""}},watch:{username:function(t){this.username=t.trim()},password:function(t){this.password=t.trim()}},props:{setting_fn:{type:Function,default:function(){}},cam:{}},computed:{},methods:{close:function(){this.setting_fn()},close_alarm:function(){var t=this;this.ws=new WebSocket("ws://".concat(window.location.host,"/ws/camera/streaming/").concat(this.cam.camera_id)),this.ws.onopen=function(){console.log(t.connecting),t.close_ws=function(){return t.ws.close()},t.send_ws=function(e){return t.ws.send(e)}},console.log("test");var e=Object(r["b"])(this.username,this.password);e.then((function(t){if(200==t.status)return t.json();window.alert("系統異常: ".concat(t.statusText))})).then((function(e){console.log(e),0===e.error_code?(t.send_ws(JSON.stringify({event:"safe"})),t.close_ws(),t.close()):window.alert("帳號密碼錯誤: ".concat(e.error_text,"(").concat(e.error_code,")"))}))}},mounted:function(){}},H=X,q=(n("b670"),Object(l["a"])(H,M,W,!1,null,"4f163b60",null)),B=q.exports,U=n("b76a"),Y=n.n(U);function K(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;return fetch("/api/cam/list-page?page=".concat(t,"&page_num=").concat(e))}var R={name:"Home",components:{CamDrag:$,draggable:Y.a,Setting:F,Alarm:B},data:function(){return{total:30,line_num:5,cams:[],show_setting:!1,show_alarm:!1,cam:{}}},computed:{col_num:function(){return"".concat(parseFloat(100/this.line_num))},line_count:function(){var t=parseInt(this.total),e=parseInt(this.line_num),n=Math.ceil(t/e);return n}},methods:{setting_fn:function(t,e){var n=this;return function(){switch(t){case"alarm":n.show_alarm=e;break;case"setting":n.show_setting=e;break}e&&(n.cam=this.data)}},debug_print:function(t){console.log("---\x3e ",t);var e=this;return function(){console.log("父元件 ",e),console.log("this is ",t)}}},mounted:function(){var t=this,e=K(),n=[],a=[];e.then((function(t){if(200==t.status)return t.json();window.alert("系統異常: ".concat(t.statusText))})).then((function(e){if(0!==e.error_code)return window.alert("錯誤: ".concat(e.error_text,"(").concat(e.error_code,")")),void(8001==e.error_code&&t.$router.push("/login"));a=e.data.datas})).then((function(){for(var e=0;e<a.length;e++)n.push({id:e,key:e,style:"height: calc( calc(100vh - 72px) /  ".concat(t.line_count,");flex: 0 0 ").concat(t.col_num,"%;\n    max-width: ").concat(t.col_num,"%;"),data:a[e]});t.cams=n}))}},z=R,G=Object(l["a"])(z,m,h,!1,null,null,null),Q=G.exports;a["a"].use(f["a"]);var V=[{path:"/",name:"Home",component:Q},{path:"/login",name:"Login",component:function(){return n.e("about").then(n.bind(null,"a55b"))}}],Z=new f["a"]({routes:V}),tt=Z;a["a"].config.productionTip=!1,new a["a"]({router:tt,render:function(t){return t(d)}}).$mount("#app")},"5c0b":function(t,e,n){"use strict";n("9c0c")},"64e3":function(t,e,n){},"6dba":function(t,e,n){},"75a4":function(t,e,n){"use strict";n("1329")},"7c04":function(t,e,n){},"9c0c":function(t,e,n){},a766:function(t,e,n){},b670:function(t,e,n){"use strict";n("6dba")},f32a:function(t,e,n){"use strict";n("24ff")}});
//# sourceMappingURL=app.82b06485.js.map